{"version":3,"sources":["webpack:///webpack/bootstrap e32e4421bbfeb0a63e04","webpack:///./src/background.js"],"names":["browser","contextMenus","create","id","title","icons","contexts","notify","message","notifications","type","getTorrentFile","info","tab","promise","Promise","resolve","reject","request","XMLHttpRequest","responseType","open","linkUrl","onreadystatechange","readyState","DONE","test","getAllResponseHeaders","Error","response","send","uploadToRutorrent","storage","local","get","then","options","url","formData","FormData","append","Math","random","size","toString","r","timeout","auth","username","password","length","replace","onload","status","ontimeout","e","onClicked","addListener","menuItemId","uploaded","catch","error","runtime","openOptionsPage"],"mappings":"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","file":"background.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 26);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e32e4421bbfeb0a63e04","browser.contextMenus.create({\r\n    id: \"upload-to-rutorrent\",\r\n    title: \"Upload to ruTorrent\",\r\n    icons: {\r\n        \"32\": \"images/rtorrent-32.png\"\r\n    },\r\n    contexts: [\"link\"],\r\n});\r\nbrowser.contextMenus.create({\r\n    id: 'options-page',\r\n    title: 'Options Page',\r\n    contexts: ['browser_action']\r\n});\r\nfunction notify(message) {\r\n    browser.notifications.create('', { type: \"basic\", title: \"ruTorrent Remote\", message: message});\r\n}\r\n\r\nfunction getTorrentFile(info, tab) {\r\n\r\n    var promise = new Promise((resolve, reject) => {\r\n        var request = new XMLHttpRequest();\r\n        request.responseType = 'blob';\r\n        request.open('GET', info.linkUrl, true);\r\n\r\n        request.onreadystatechange = function () {\r\n            if (request.readyState !== XMLHttpRequest.DONE) \r\n                return;\r\n            if (!/\\.torrent/.test(request.getAllResponseHeaders())) {\r\n                reject(new Error('Unable to determine whether file is a torrent'));\r\n            }\r\n\r\n            resolve(request.response)\r\n        }\r\n\r\n        request.send(null);\r\n    });\r\n\r\n    return promise;\r\n}\r\nfunction uploadToRutorrent(response) {\r\n    return browser.storage.local.get()\r\n        .then((options) => {\r\n            var promise = new Promise((resolve, reject) => {\r\n            if (options.url == null) {\r\n                reject(new Error(\"Goto Add-ons -> ruTorrent Remote -> Options and set the options.\"));\r\n                return;\r\n            }\r\n\r\n            var formData = new FormData();\r\n            formData.append('torrent_file', response, (Math.random() * response.size).toString() + \".torrent\");\r\n\r\n            var r = new XMLHttpRequest();\r\n            r.timeout = 5000;\r\n            \r\n            var url = '';\r\n            var auth = options.username + ':' + options.password + '@';\r\n            if (options.username.length > 0)\r\n                url = (options.url.replace(\":\\/\\/\", \"://\" + auth));\r\n            r.open('POST', url + '/php/addtorrent.php', true);\r\n            r.onload = function() {\r\n                if (this.status == 200) {\r\n                    resolve(\"Uploaded\");\r\n                }\r\n                else {\r\n                    reject(new Error(\"Failed to upload: \" + this.status));\r\n                }\r\n            }\r\n            r.ontimeout = function(e) {\r\n                reject(new Error(\"Timed out\"));\r\n            }\r\n            r.send(formData);\r\n        });\r\n        return promise;\r\n    });\r\n}\r\n\r\nbrowser.contextMenus.onClicked.addListener((info, tab) => {\r\n    if (info.menuItemId === \"upload-to-rutorrent\") {\r\n        getTorrentFile(info, tab)\r\n            .then(function(response) {\r\n                uploadToRutorrent(response)\r\n                    .then(function(uploaded) {\r\n                        notify(uploaded);\r\n                    })\r\n                    .catch(function(error) {\r\n                        notify(error.message);\r\n                    });\r\n            })\r\n            .catch(function (error) {\r\n                notify(error.message);\r\n            });\r\n    }\r\n    if (info.menuItemId === 'options-page') {\r\n        browser.runtime.openOptionsPage()\r\n    }\r\n});\n\n\n// WEBPACK FOOTER //\n// ./src/background.js"],"sourceRoot":""}