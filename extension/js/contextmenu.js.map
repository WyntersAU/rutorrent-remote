{"version":3,"sources":["webpack:///webpack/bootstrap c311eb09127007c4cdb6","webpack:///./src/contextmenu.js"],"names":["initContextMenu","browser","contextMenus","create","id","title","icons","contexts","onClicked","addListener","info","tab","menuItemId","getTorrentFile","then","response","uploadToRutorrent","uploaded","notify","catch","error","message","notifications","type","promise","Promise","resolve","reject","request","XMLHttpRequest","responseType","open","linkUrl","onreadystatechange","readyState","DONE","test","getAllResponseHeaders","Error","send","storage","local","get","options","url","formData","FormData","append","Math","random","size","toString","r","timeout","auth","username","password","length","replace","onload","status","ontimeout","e"],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;;;;;;QC7DgBA,e,GAAAA,e;AAAT,SAASA,eAAT,GAA2B;AAC9BC,YAAQC,YAAR,CAAqBC,MAArB,CAA4B;AACxBC,YAAI,qBADoB;AAExBC,eAAO,qBAFiB;AAGxBC,eAAO;AACH,kBAAM;AADH,SAHiB;AAMxBC,kBAAU,CAAC,MAAD;AANc,KAA5B;;AASAN,YAAQC,YAAR,CAAqBM,SAArB,CAA+BC,WAA/B,CAA2C,CAACC,IAAD,EAAOC,GAAP,KAAe;AAC1D,YAAID,KAAKE,UAAL,KAAoB,qBAAxB,EAA+C;AAC3CC,2BAAeH,IAAf,EAAqBC,GAArB,EACKG,IADL,CACU,UAASC,QAAT,EAAmB;AACrBC,kCAAkBD,QAAlB,EACKD,IADL,CACU,UAASG,QAAT,EAAmB;AACrBC,2BAAOD,QAAP;AACH,iBAHL,EAIKE,KAJL,CAIW,UAASC,KAAT,EAAgB;AACnBF,2BAAOE,MAAMC,OAAb;AACH,iBANL;AAOH,aATL,EAUKF,KAVL,CAUW,UAAUC,KAAV,EAAiB;AACpBF,uBAAOE,MAAMC,OAAb;AACH,aAZL;AAaH;AACA,KAhBD;AAiBH;;AAGD,SAASH,MAAT,CAAgBG,OAAhB,EAAyB;AACrBpB,YAAQqB,aAAR,CAAsBnB,MAAtB,CAA6B,EAA7B,EAAiC,EAAEoB,MAAM,OAAR,EAAiBlB,OAAO,kBAAxB,EAA4CgB,SAASA,OAArD,EAAjC;AACH;;AAED,SAASR,cAAT,CAAwBH,IAAxB,EAA8BC,GAA9B,EAAmC;;AAE/B,QAAIa,UAAU,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AAC3C,YAAIC,UAAU,IAAIC,cAAJ,EAAd;AACAD,gBAAQE,YAAR,GAAuB,MAAvB;AACAF,gBAAQG,IAAR,CAAa,KAAb,EAAoBrB,KAAKsB,OAAzB,EAAkC,IAAlC;;AAEAJ,gBAAQK,kBAAR,GAA6B,YAAY;AACrC,gBAAIL,QAAQM,UAAR,KAAuBL,eAAeM,IAA1C,EACI;AACJ,gBAAI,CAAC,YAAYC,IAAZ,CAAiBR,QAAQS,qBAAR,EAAjB,CAAL,EAAwD;AACpDV,uBAAO,IAAIW,KAAJ,CAAU,+CAAV,CAAP;AACH;;AAEDZ,oBAAQE,QAAQb,QAAhB;AACH,SARD;;AAUAa,gBAAQW,IAAR,CAAa,IAAb;AACH,KAhBa,CAAd;;AAkBA,WAAOf,OAAP;AACH;AACD,SAASR,iBAAT,CAA2BD,QAA3B,EAAqC;AACjC,WAAOd,QAAQuC,OAAR,CAAgBC,KAAhB,CAAsBC,GAAtB,GACF5B,IADE,CACI6B,OAAD,IAAa;AACf,YAAInB,UAAU,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AAC/C,gBAAIgB,QAAQC,GAAR,IAAe,IAAnB,EAAyB;AACrBjB,uBAAO,IAAIW,KAAJ,CAAU,kEAAV,CAAP;AACA;AACH;;AAED,gBAAIO,WAAW,IAAIC,QAAJ,EAAf;AACAD,qBAASE,MAAT,CAAgB,cAAhB,EAAgChC,QAAhC,EAA0C,CAACiC,KAAKC,MAAL,KAAgBlC,SAASmC,IAA1B,EAAgCC,QAAhC,KAA6C,UAAvF;;AAEA,gBAAIC,IAAI,IAAIvB,cAAJ,EAAR;AACAuB,cAAEC,OAAF,GAAY,IAAZ;;AAEA,gBAAIT,MAAM,EAAV;AACA,gBAAIU,OAAOX,QAAQY,QAAR,GAAmB,GAAnB,GAAyBZ,QAAQa,QAAjC,GAA4C,GAAvD;AACA,gBAAIb,QAAQY,QAAR,CAAiBE,MAAjB,GAA0B,CAA9B,EACIb,MAAOD,QAAQC,GAAR,CAAYc,OAAZ,CAAoB,OAApB,EAA6B,QAAQJ,IAArC,CAAP;AACJF,cAAErB,IAAF,CAAO,MAAP,EAAea,MAAM,qBAArB,EAA4C,IAA5C;AACAQ,cAAEO,MAAF,GAAW,YAAW;AAClB,oBAAI,KAAKC,MAAL,IAAe,GAAnB,EAAwB;AACpBlC,4BAAQ,UAAR;AACH,iBAFD,MAGK;AACDC,2BAAO,IAAIW,KAAJ,CAAU,uBAAuB,KAAKsB,MAAtC,CAAP;AACH;AACJ,aAPD;AAQAR,cAAES,SAAF,GAAc,UAASC,CAAT,EAAY;AACtBnC,uBAAO,IAAIW,KAAJ,CAAU,WAAV,CAAP;AACH,aAFD;AAGAc,cAAEb,IAAF,CAAOM,QAAP;AACH,SA7BiB,CAAd;AA8BJ,eAAOrB,OAAP;AACH,KAjCM,CAAP;AAkCH,C","file":"contextmenu.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 20);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap c311eb09127007c4cdb6","export function initContextMenu() {\r\n    browser.contextMenus.create({\r\n        id: \"upload-to-rutorrent\",\r\n        title: \"Upload to ruTorrent\",\r\n        icons: {\r\n            \"32\": \"icons/upload-32.png\"\r\n        },\r\n        contexts: [\"link\"],\r\n    });\r\n\r\n    browser.contextMenus.onClicked.addListener((info, tab) => {\r\n    if (info.menuItemId === \"upload-to-rutorrent\") {\r\n        getTorrentFile(info, tab)\r\n            .then(function(response) {\r\n                uploadToRutorrent(response)\r\n                    .then(function(uploaded) {\r\n                        notify(uploaded);\r\n                    })\r\n                    .catch(function(error) {\r\n                        notify(error.message);\r\n                    });\r\n            })\r\n            .catch(function (error) {\r\n                notify(error.message);\r\n            });\r\n    }    \r\n    });\r\n} \r\n\r\n\r\nfunction notify(message) {\r\n    browser.notifications.create('', { type: \"basic\", title: \"ruTorrent Remote\", message: message});\r\n}\r\n\r\nfunction getTorrentFile(info, tab) {\r\n\r\n    var promise = new Promise((resolve, reject) => {\r\n        var request = new XMLHttpRequest();\r\n        request.responseType = 'blob';\r\n        request.open('GET', info.linkUrl, true);\r\n\r\n        request.onreadystatechange = function () {\r\n            if (request.readyState !== XMLHttpRequest.DONE) \r\n                return;\r\n            if (!/\\.torrent/.test(request.getAllResponseHeaders())) {\r\n                reject(new Error('Unable to determine whether file is a torrent'));\r\n            }\r\n\r\n            resolve(request.response)\r\n        }\r\n\r\n        request.send(null);\r\n    });\r\n\r\n    return promise;\r\n}\r\nfunction uploadToRutorrent(response) {\r\n    return browser.storage.local.get()\r\n        .then((options) => {\r\n            var promise = new Promise((resolve, reject) => {\r\n            if (options.url == null) {\r\n                reject(new Error(\"Goto Add-ons -> ruTorrent Remote -> Options and set the options.\"));\r\n                return;\r\n            }\r\n\r\n            var formData = new FormData();\r\n            formData.append('torrent_file', response, (Math.random() * response.size).toString() + \".torrent\");\r\n\r\n            var r = new XMLHttpRequest();\r\n            r.timeout = 5000;\r\n            \r\n            var url = '';\r\n            var auth = options.username + ':' + options.password + '@';\r\n            if (options.username.length > 0)\r\n                url = (options.url.replace(\":\\/\\/\", \"://\" + auth));\r\n            r.open('POST', url + '/php/addtorrent.php', true);\r\n            r.onload = function() {\r\n                if (this.status == 200) {\r\n                    resolve(\"Uploaded\");\r\n                }\r\n                else {\r\n                    reject(new Error(\"Failed to upload: \" + this.status));\r\n                }\r\n            }\r\n            r.ontimeout = function(e) {\r\n                reject(new Error(\"Timed out\"));\r\n            }\r\n            r.send(formData);\r\n        });\r\n        return promise;\r\n    });\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/contextmenu.js"],"sourceRoot":""}